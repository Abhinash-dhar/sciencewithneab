<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neab Learning: Class 12 PCMB Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Apply Inter font family */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        /* Font for Calculator Display/Buttons */
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc; /* Light background for the whole page */
        }
        .hikmah-primary {
            color: #067c4d; 
        }
        .hikmah-bg-primary {
            background-color: #067c4d; 
        }
        .hikmah-hover:hover {
            background-color: #056a42;
        }
        
        .content-area {
            background-color: white;
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
            min-height: 70vh;
            transition: opacity 0.3s ease-in-out; 
        }

        .tab-button {
            padding: 0.6rem 1.2rem;
            border-radius: 0.75rem;
            transition: all 0.3s;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
        }
        .tab-active {
            background-color: #067c4d;
            color: white;
            box-shadow: 0 4px 12px rgba(6, 124, 77, 0.3);
        }
        .tab-inactive {
            background-color: #e5e7eb; /* Gray-100 */
            color: #4b5563; /* Gray-600 */
        }
        .chapter-card {
            transition: transform 0.2s, background-color 0.2s, box-shadow 0.3s;
            cursor: pointer;
        }
        .chapter-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            background-color: #f3f4f6;
        }
        
        #filter-tabs {
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        #filter-tabs::-webkit-scrollbar {
            display: none;
        }
        
        .lesson-intro-animate {
            animation: lessonZoomBounce 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }

        @keyframes lessonZoomBounce {
            0% { 
                opacity: 0; 
                transform: scale(0.95) translateY(20px);
            }
            70% { 
                opacity: 1; 
                transform: scale(1.01) translateY(0);
            }
            100% { 
                opacity: 1; 
                transform: scale(1) translateY(0);
            }
        }


        .fade-in-content {
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* New Styles for Aesthetic Welcome Animation */
        .welcome-card-animate {
            opacity: 0; /* Start hidden */
            animation: welcome-fade-in 0.8s ease-out forwards;
        }
        
        .welcome-text-animate {
            opacity: 0; /* Start hidden */
            animation: welcome-text-slide 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes welcome-fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes welcome-text-slide {
            0% { opacity: 0; transform: translateY(10px); }
            40% { opacity: 0; } 
            100% { opacity: 1; transform: translateY(0); }
        }
        
        /* Mandatory Tailwind classes for dynamic color generation */
        .border-blue-400, .bg-blue-50, .text-blue-600, .bg-blue-500, .text-blue-800 {}
        .border-orange-400, .bg-orange-50, .text-orange-600, .bg-orange-500, .text-orange-800 {}
        .border-green-400, .bg-green-50, .text-green-600, .bg-green-500, .text-green-800 {}
        .text-red-600, .text-red-500, .bg-red-50, .border-red-200, .text-gray-600 {}
        .border-purple-400, .bg-purple-50, .text-purple-600, .bg-purple-500, .text-purple-800, .bg-purple-600 {}

        /* --- Custom Styles for Periodic Table Colors --- */
        .color-nonmetal { background-color: #4ade80; color: #166534; } /* Green */
        .color-alkali-metal { background-color: #fca5a5; color: #991b1b; } /* Light Red */
        .color-alkaline-earth-metal { background-color: #fcd34d; color: #92400e; } /* Yellow */
        .color-metalloid { background-color: #a78bfa; color: #5b21b6; } /* Purple */
        .color-post-transition-metal { background-color: #60a5fa; color: #1e40af; } /* Blue */
        .color-transition-metal { background-color: #f97316; color: #9a3412; } /* Orange */
        .color-lanthanide { background-color: #facc15; color: #a16207; } /* Gold */
        .color-actinide { background-color: #c084fc; color: #7e22ce; } /* Violet */
        .color-noble-gas { background-color: #38bdf8; color: #075985; } /* Cyan */
        .color-halogen { background-color: #f472b6; color: #9d174d; } /* Pink */
        .color-unknown { background-color: #e5e7eb; color: #4b5563; } /* Gray */

        /* Calculator specific styles */
        .calc-display {
            font-family: 'Fira Code', monospace;
            text-align: right;
        }
        .calc-button {
            font-family: 'Fira Code', monospace;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .calc-button:active {
            transform: scale(0.95);
            box-shadow: none;
        }
    </style>
</head>
<body class="min-h-screen">

    <header class="bg-white shadow-lg sticky top-0 z-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div class="text-2xl font-extrabold flex items-center cursor-pointer" onclick="renderPage('dashboard')">
                <span class="text-gray-800 mr-1">Neab</span><span class="hikmah-primary">Learning</span>
            </div>

            <nav class="flex space-x-4 text-gray-600 font-medium overflow-x-auto md:space-x-6 md:overflow-x-visible pb-1">
                <a href="#" onclick="renderPage('subject', 'Physics')" class="hover:hikmah-primary transition whitespace-nowrap">Physics</a>
                <a href="#" onclick="renderPage('subject', 'Chemistry')" class="hover:hikmah-primary transition whitespace-nowrap">Chemistry</a>
                <a href="#" onclick="renderPage('subject', 'Math')" class="hover:hikmah-primary transition whitespace-nowrap">Mathematics</a>
                <a href="#" onclick="renderPage('subject', 'Biology')" class="hover:hikmah-primary transition whitespace-nowrap">Biology</a>
                <a href="#" onclick="renderPage('tools')" class="hover:hikmah-primary transition font-bold text-blue-600 whitespace-nowrap">Tools</a>
            </nav>

            <div class="flex items-center space-x-4">
                <button class="bg-gray-100 p-2 rounded-full hover:bg-gray-200 transition relative"
                    onclick="renderPage('notifications')">
                    <i data-lucide="bell" class="w-5 h-5 text-gray-600"></i>
                    <span id="unread-indicator" class="absolute top-1 right-1 block h-2 w-2 rounded-full bg-red-500 transition-opacity" style="opacity: 0;"></span>
                </button>
                <button class="hikmah-bg-primary text-white px-4 py-2 rounded-lg font-semibold shadow-md hover:hikmah-hover transition hidden sm:block"
                    onclick="renderPage('profile')">
                    Profile
                </button>
                </div>
        </div>
    </header>

    <main id="app-content" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-10 mb-16">
        <div class="content-area p-10 text-center">
            <i data-lucide="loader" class="w-10 h-10 animate-spin text-gray-400 mx-auto"></i>
            <p class="text-gray-600 mt-3">Initializing platform...</p>
        </div>
    </main>

    <footer class="text-center py-6 text-gray-500 text-sm">
        &copy; 2025 Neab Learning Platform. All rights reserved. Built by Abhinash.
    </footer>

    <div id="element-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4" onclick="closeElementProperties()">
        <div id="element-modal-content" class="bg-white rounded-xl p-6 shadow-2xl max-w-lg w-full transform transition-all duration-300 scale-95 opacity-0" onclick="event.stopPropagation()">
            <div class="flex justify-between items-start border-b pb-3 mb-4">
                <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i data-lucide="info" class="w-6 h-6 mr-2 text-blue-600"></i>
                    Element Properties
                </h3>
                <button onclick="closeElementProperties()" class="text-gray-500 hover:text-red-500 transition">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div id="element-details" class="space-y-3">
                </div>
        </div>
    </div>


    <script type="module">
        // -------------------------------------------------------------------
        // FIX: SIMPLIFIED INITIALIZATION FOR LOCAL/STANDALONE USE
        // -------------------------------------------------------------------
        // The original code used Firebase imports which often fail when running 
        // the file locally due to CORS/module restrictions.
        // We remove those imports and enforce the local mock mode for progress
        // tracking, ensuring the dashboard loads with color immediately.

        // MOCK/LOCAL PROGRESS STORE
        let userProgress = {};
        const userId = 'mock-user-local'; 

        window.__currentSubject = null;
        window.__currentChapterId = null;
        window.__currentPage = null; 
        window.__currentTool = 'calculator';

        // MOCK FUNCTIONS FOR PROGRESS
        async function saveProgress(chapterId, isComplete) {
            const now = new Date().toISOString();
            console.warn("Saving progress in mock mode.");
            userProgress[chapterId] = { completed: isComplete, timestamp: now };
            if (window.__currentSubject && window.__currentChapterId === chapterId) {
                renderPage('lesson', window.__currentSubject, window.__currentChapterId, { skipAnimation: true });
            }
            if (window.__currentPage === 'profile' || window.__currentPage === 'notifications') {
                renderPage(window.__currentPage, null, null, { skipAnimation: true });
            }
            updateUnreadIndicator();
        }
        
        window.toggleChapterComplete = function(subject, chapterId, isComplete) {
             saveProgress(chapterId, isComplete);
        }

        // MOCK FUNCTION FOR LOADING
        function initializeAppLogic() {
            // This now just simulates the successful load and renders the dashboard
            console.log("App initialized in mock mode. Rendering dashboard.");
            renderPage('dashboard');
        }
        // -------------------------------------------------------------------


        // --- NCERT Chapter Data and Course Data (Unchanged) ---
        const courseData = [
            { id: 1, title: "Electromagnetism: Advanced Concepts", image: "https://placehold.co/400x250/007AFF/ffffff?text=Physics", description: "Detailed lectures on Electrostatics, EMI, and AC Circuits. Essential for JEE/NEET.", subject: "Physics", duration: null, capacity: "Unlimited" }, 
            { id: 2, title: "Organic Chemistry: Named Reactions", image: "https://placehold.co/400x250/F59E0B/ffffff?text=Chemistry", description: "In-depth mechanism and practice for all key named reactions (e.g., Aldol, Cannizaro).", subject: "Chemistry", duration: null, capacity: "50 Seats" }, 
            { id: 3, title: "Advanced Calculus: Integration & Vectors", image: "https://placehold.co/400x250/10B981/ffffff?text=Math", description: "Master Definite Integrals, Differential Equations, and 3D Vector Algebra.", subject: "Math", duration: null, capacity: "Unlimited" }, 
            { id: 4, title: "Modern Biology: Genetics & Ecology", image: "https://placehold.co/400x250/9333ea/ffffff?text=Biology", description: "Master Mendel's principles, Molecular Biology, and key ecological interactions. Essential for NEET.", subject: "Biology", duration: null, capacity: "Unlimited" },
        ];
        
        const ncertChapters = {
            'Physics': [
                { id: 'P1', chapter: 1, title: "Electric Charges and Fields" },
                { id: 'P2', chapter: 2, title: "Electrostatic Potential and Capacitance" },
                { id: 'P3', chapter: 3, title: "Current Electricity" },
                { id: 'P4', chapter: 4, title: "Moving Charges and Magnetism" },
                { id: 'P5', chapter: 5, title: "Magnetism and Matter" },
                { id: 'P6', chapter: 6, title: "Electromagnetic Induction" },
                { id: 'P7', chapter: 7, title: "Alternating Current" },
                { id: 'P8', chapter: 8, title: "Electromagnetic Waves" },
                { id: 'P9', chapter: 9, title: "Ray Optics and Optical Instruments" },
                { id: 'P10', chapter: 10, title: "Wave Optics" },
                { id: 'P11', chapter: 11, title: "Dual Nature of Radiation and Matter" },
                { id: 'P12', chapter: 12, title: "Atoms" },
                { id: 'P13', chapter: 13, title: "Nuclei" },
                { id: 'P14', chapter: 14, title: "Semiconductor Electronics: Materials, Devices and Simple Circuits" },
            ],
            'Chemistry': [
                { id: 'C1', chapter: 1, title: "Solutions" },
                { id: 'C2', chapter: 2, title: "Electrochemistry" },
                { id: 'C3', chapter: 3, title: "Chemical Kinetics" },
                { id: 'C4', chapter: 4, title: "d and f-Block Elements" },
                { id: 'C5', chapter: 5, title: "Coordination Compounds" },
                { id: 'C6', chapter: 6, title: "Haloalkanes and Haloarenes" },
                { id: 'C7', chapter: 7, title: "Alcohols, Phenols and Ethers" },
                { id: 'C8', chapter: 8, title: "Aldehydes, Ketones and Carboxylic Acids" },
                { id: 'C9', chapter: 9, title: "Amines" },
                { id: 'C10', chapter: 10, "title": "Biomolecules" },
            ],
            'Math': [
                { id: 'M1', chapter: 1, title: "Relations and Functions" },
                { id: 'M2', chapter: 2, title: "Inverse Trigonometric Functions" },
                { id: 'M3', chapter: 3, title: "Matrices" },
                { id: 'M4', chapter: 4, "title": "Determinants" },
                { id: 'M5', chapter: 5, "title": "Continuity and Differentiability" },
                { id: 'M6', chapter: 6, "title": "Applications of Derivatives" },
                { id: 'M7', chapter: 7, "title": "Integrals" },
                { id: 'M8', chapter: 8, "title": "Applications of Integrals" },
                { id: 'M9', chapter: 9, "title": "Differential Equations" },
                { id: 'M10', chapter: 10, "title": "Vector Algebra" },
                { id: 'M11', chapter: 11, "title": "Three Dimensional Geometry" },
                { id: 'M12', chapter: 12, "title": "Linear Programming" },
                { id: 'M13', chapter: 13, "title": "Probability" },
            ],
            'Biology': [
                { id: 'B1', chapter: 1, title: "Reproduction in Organisms" },
                { id: 'B2', chapter: 2, title: "Sexual Reproduction in Flowering Plants" },
                { id: 'B3', chapter: 3, title: "Human Reproduction" },
                { id: 'B4', chapter: 4, title: "Reproductive Health" },
                { id: 'B5', chapter: 5, title: "Principles of Inheritance and Variation" },
                { id: 'B6', chapter: 6, title: "Molecular Basis of Inheritance" },
                { id: 'B7', chapter: 7, title: "Evolution" },
                { id: 'B8', chapter: 8, title: "Human Health and Disease" },
                { id: 'B9', chapter: 9, title: "Strategies for Enhancement in Food Production" },
                { id: 'B10', chapter: 10, title: "Microbes in Human Welfare" },
                { id: 'B11', chapter: 11, title: "Biotechnology: Principles and Processes" },
                { id: 'B12', chapter: 12, title: "Biotechnology and its Applications" },
                { id: 'B13', chapter: 13, title: "Organisms and Populations" },
                { id: 'B14', chapter: 14, "title": "Ecosystem" },
                { id: 'B15', chapter: 15, "title": "Biodiversity and Conservation" },
                { id: 'B16', chapter: 16, "title": "Environmental Issues" },
            ],
        };
        
        const chapterFormulas = {
            'P1': [
                { name: "Coulomb's Law", formula: `$$F = k \\frac{|q_1 q_2|}{r^2}$$` },
                { name: "Electric Field", formula: `$$\\vec{E} = \\frac{\\vec{F}}{q_0}$$` },
                { name: "Electric Field from Point Charge", formula: `$$E = k \\frac{|q|}{r^2}$$` },
            ],
            'P2': [
                { name: "Electric Potential", formula: `$$V = \\frac{W}{q_0}$$` },
                { name: "Capacitance (General)", formula: `$$C = \\frac{Q}{V}$$` },
                { name: "Capacitance (Parallel Plate)", formula: `$$C = \\frac{\\epsilon_0 A}{d}$$` },
            ],
            'C1': [
                { name: "Raoult's Law (Volatile Components)", formula: `$$P_{\\text{total}} = P_A^0 x_A + P_B^0 x_B$$` },
                { name: "Molality", formula: `$$m = \\frac{\\text{moles of solute}}{\\text{mass of solvent (kg)}}$$` },
                { name: "Freezing Point Depression", formula: `$$\\Delta T_f = i K_f m$$` },
            ],
            'C2': [
                 { name: "Nernst Equation", formula: `$$E_{\\text{cell}} = E_{\\text{cell}}^0 - \\frac{0.0591}{n} \\log Q$$` },
                 { name: "Gibbs Free Energy", formula: `$$\\Delta G^0 = -n F E_{\\text{cell}}^0$$` },
                 { name: "Kohlrausch's Law", formula: `$$\\Lambda_m^0 = x \\lambda_A + y \\lambda_B$$` },
            ],
            'M1': [
                { name: "Identity Function", formula: `$$f(x) = x$$` },
                { name: "Composite Function", formula: `$$g \\circ f(x) = g(f(x))$$` },
                { name: "Range of Function $f$", formula: `$$\\text{Range}(f) = \\{ f(x) : x \\in \\text{Domain}(f) \\}$$` },
            ],
             'M2': [
                { name: "Principal Value Branch", formula: `$$\\sin^{-1} x \\in \\left[ -\\frac{\\pi}{2}, \\frac{\\pi}{2} \\right]$$` },
                { name: "Inverse Tangent Identity", formula: `$$\\tan^{-1} x + \\cot^{-1} x = \\frac{\\pi}{2}$$` },
                { name: "Conversion Formula", formula: `$$\\cos^{-1} x = \\sin^{-1} \\sqrt{1-x^2}$$` },
            ],
            'B5': [ 
                { name: "Mendel's First Law (Monohybrid)", formula: `$$T \\times t \\rightarrow \\text{all } Tt \\text{ in } F_1$$` },
                { name: "Dihybrid Phenotypic Ratio", formula: `$$9:3:3:1 \\text{ (In } F_2 \\text{ generation)}$$` },
                { name: "Test Cross Ratio", formula: `$$1:1:1:1 \\text{ (Dihybrid)}$$` },
            ],
            'B6': [ 
                { name: "Chargaff's Rule", formula: `$$\\frac{[A] + [G]}{[T] + [C]} = 1$$` },
                { name: "Central Dogma (Simplified)", formula: `$$\\text{DNA} \\xrightarrow{\\text{Transcription}} \\text{RNA} \\xrightarrow{\\text{Translation}} \\text{Protein}$$` },
            ],
        };

        function calculateTotalChapters() {
            let total = 0;
            for (const subject in ncertChapters) {
                total += ncertChapters[subject].length;
            }
            return total;
        }

        function calculateCompletedChapters() {
            let completedCount = 0;
            for (const chapterId in userProgress) {
                if (userProgress[chapterId]?.completed === true) {
                    completedCount++;
                }
            }
            return completedCount;
        }
        // --- END: NCERT Chapter Data and Course Data ---


        // --- NOTIFICATION LOGIC (Modified to use localProgress) ---
        
        const staticNotifications = [
            { id: 'S1', type: 'System', title: 'Platform Update', message: 'Academic Year **2025-26** NCERT Syllabus is now fully loaded.', date: '2025-10-21T10:00:00.000Z', read: false, action: "renderPage('dashboard')" },
            { id: 'S2', type: 'System', title: 'Welcome!', message: 'Explore the Notes and Key Formulas tab for Chapter P1: Electric Charges and Fields.', date: '2025-10-21T09:00:00.000Z', read: true, action: "renderPage('lesson', 'Physics', 'P1')" },
        ];
        
        function generateRealTimeNotifications() {
            let notifications = [...staticNotifications];
            for (const chapterId in userProgress) {
                const progress = userProgress[chapterId];
                
                let chapter = null;
                let subject = '';
                for (const sub in ncertChapters) {
                    const found = ncertChapters[sub].find(c => c.id === chapterId);
                    if (found) {
                        chapter = found;
                        subject = sub;
                        break;
                    }
                }
                
                if (!chapter || !progress.timestamp) continue;
                
                if (progress.completed) {
                    notifications.push({
                        id: `P-${chapterId}`,
                        type: 'Progress',
                        title: `Chapter ${chapter.chapter} Completed!`,
                        message: `You successfully completed the notes for **${subject}: ${chapter.title}**. Keep up the great work!`,
                        date: progress.timestamp,
                        read: false,
                        action: `renderPage('lesson', '${subject}', '${chapterId}')`
                    });
                } 
            }

            notifications.sort((a, b) => new Date(b.date) - new Date(a.date));

            const newestProgressDate = notifications.filter(n => n.type === 'Progress').reduce((maxDate, n) => {
                 const current = new Date(n.date);
                 return current > maxDate ? current : maxDate;
            }, new Date(0));

            return notifications.map(n => {
                 if (n.type !== 'Progress' && new Date(n.date) < newestProgressDate) {
                     return { ...n, read: true };
                 }
                 return n;
            });
        }
        
        function updateUnreadIndicator() {
            const indicator = document.getElementById('unread-indicator');
            if (!indicator) return;
            
            const notifications = generateRealTimeNotifications();
            const unreadCount = notifications.filter(n => !n.read).length;
            
            indicator.style.opacity = unreadCount > 0 ? '1' : '0';
        }
        // --- END: NOTIFICATION LOGIC ---


        // --- PAGE RENDERING LOGIC (Updated to include 'tools') ---

        window.renderPage = function(pageName, identifier1 = null, identifier2 = null, options = {}) {
            const appContent = document.getElementById('app-content');
            const { skipAnimation = false } = options;

            appContent.classList.remove('lesson-intro-animate');
            appContent.style.opacity = '0'; 

            window.__currentSubject = identifier1;
            window.__currentChapterId = identifier2;
            window.__currentPage = pageName; 

            setTimeout(() => {
                let pageHtml = '';
                if (pageName === 'dashboard') {
                    pageHtml = renderDashboardPage();
                } else if (pageName === 'subject') {
                    pageHtml = renderSubjectPage(identifier1); 
                } else if (pageName === 'lesson') {
                    const chapter = ncertChapters[identifier1] ? ncertChapters[identifier1].find(c => c.id === identifier2) : null;
                    if (chapter) {
                         pageHtml = renderLessonPage(identifier1, identifier2);
                    } else {
                         pageHtml = renderErrorPage('Chapter Not Found', 'The chapter reference is invalid. Please go back to the subject list.');
                    }
                } else if (pageName === 'profile') { 
                    pageHtml = renderProfilePage();
                } else if (pageName === 'notifications') { 
                    pageHtml = renderNotificationPage();
                } else if (pageName === 'tools') { 
                    pageHtml = renderToolsPage();
                } else {
                    pageHtml = renderErrorPage('Page Not Found', `The page "${pageName}" could not be loaded.`);
                }


                appContent.innerHTML = pageHtml;
                lucide.createIcons();
                
                if (pageName === 'lesson' && !skipAnimation) {
                    appContent.classList.add('lesson-intro-animate');
                } else {
                    appContent.style.opacity = '1';
                }

                if (pageName === 'lesson') {
                    setTimeout(() => {
                        updateLessonContent('Notes', identifier1, identifier2);
                    }, 50); 
                }
                
                if (pageName === 'notifications') {
                    updateUnreadIndicator();
                }
                
                if (pageName === 'tools') {
                    updateToolContent(window.__currentTool); 
                }

                console.log(`Rendering page: ${pageName}, Subject: ${identifier1}, Chapter ID: ${identifier2}`);
            }, 100);
        }

        // --- NEW FUNCTION: Renders the Tools Page ---
        window.renderToolsPage = function() {
            // Note: The __currentTool state is set/updated by updateToolContent
            
            return `
                <div class="content-area p-6 lg:p-10">
                    <h1 class="text-3xl lg:text-4xl font-extrabold text-gray-900 mb-8 border-b pb-4 flex items-center">
                        <i data-lucide="wrench" class="w-8 h-8 mr-3 text-blue-600"></i> Essential Academic Tools
                    </h1>

                    <div class="flex space-x-4 overflow-x-auto border-b pb-1 mb-6">
                        <button id="tool-calculator" onclick="updateToolContent('calculator')" class="text-gray-500 hover:text-blue-700 font-medium py-2 transition whitespace-nowrap">
                            <i data-lucide="calculator" class="w-4 h-4 mr-1 inline-block"></i> Scientific Calculator
                        </button>
                        <button id="tool-periodic-table" onclick="updateToolContent('periodic-table')" class="text-gray-500 hover:text-blue-700 font-medium py-2 transition whitespace-nowrap">
                            <i data-lucide="atom" class="w-4 h-4 mr-1 inline-block"></i> Periodic Table
                        </button>
                        <button id="tool-unit-converter" onclick="updateToolContent('unit-converter')" class="text-gray-500 hover:text-blue-700 font-medium py-2 transition whitespace-nowrap">
                            <i data-lucide="scale" class="w-4 h-4 mr-1 inline-block"></i> Unit Converter
                        </button>
                    </div>

                    <div id="tool-content-display" class="min-h-[600px] border border-gray-200 rounded-xl p-4 lg:p-8 bg-gray-50 shadow-inner">
                        </div>
                </div>
            `;
        }

        // --- NEW FUNCTION: Updates the content area within the Tools Page ---
        window.updateToolContent = function(toolName) {
            const contentDiv = document.getElementById('tool-content-display');
            if (!contentDiv) return;

            // Update global state
            window.__currentTool = toolName;

            // Update button states
            const tools = ['calculator', 'periodic-table', 'unit-converter'];
            tools.forEach(tool => {
                const btn = document.getElementById(`tool-${tool}`);
                if (btn) {
                    btn.className = (tool === toolName) 
                        ? 'text-blue-600 border-b-2 border-blue-600 font-semibold py-2 transition whitespace-nowrap'
                        : 'text-gray-500 hover:text-gray-700 font-medium py-2 transition whitespace-nowrap';
                }
            });

            // Added Fade-in animation when switching tabs
            contentDiv.classList.remove('fade-in-content');
            void contentDiv.offsetWidth; 
            contentDiv.classList.add('fade-in-content');

            let contentHtml = '';
            
            if (toolName === 'calculator') {
                contentHtml = renderScientificCalculator();
                // Need to initialize the calculator state after rendering
                setTimeout(initializeCalculator, 100);
            } else if (toolName === 'periodic-table') {
                contentHtml = renderPeriodicTable();
                setTimeout(lucide.createIcons, 100);
            } else if (toolName === 'unit-converter') {
                contentHtml = renderUnitConverter();
                // Need to initialize the converter state after rendering
                setTimeout(initializeUnitConverter, 100); 
            }

            contentDiv.innerHTML = contentHtml;
            lucide.createIcons();
        }

        // -------------------------------------------------------------------
        // --- 1. SCIENTIFIC CALCULATOR IMPLEMENTATION ---
        // -------------------------------------------------------------------
        
        let displayValue = '0';
        let currentExpression = '';
        let resultDisplayed = false;

        function initializeCalculator() {
            // Reset state
            displayValue = '0';
            currentExpression = '';
            resultDisplayed = false;
            updateCalculatorDisplay();
        }
        
        function updateCalculatorDisplay() {
            const resultEl = document.getElementById('calc-display-result');
            const historyEl = document.getElementById('calc-display-history');
            if(resultEl) resultEl.value = displayValue;
            if(historyEl) historyEl.innerText = currentExpression;
        }

        window.appendInput = function(input) {
            const displayEl = document.getElementById('calc-display-result');
            if (!displayEl) return;
            
            if (resultDisplayed) {
                if ('+-*/'.includes(input)) {
                    currentExpression = displayValue;
                } else {
                    currentExpression = '';
                }
                displayValue = (input === '0' || '+-*/'.includes(input)) ? displayValue : '';
                resultDisplayed = false;
            }

            if (displayValue === '0' && !'+-*/'.includes(input)) {
                displayValue = '';
            }
            
            // Basic input sanitation to prevent double operators/decimals
            if (displayValue.length > 0 && '+-*/'.includes(input) && '+-*/'.includes(displayValue.slice(-1))) {
                 // Replace last operator
                 displayValue = displayValue.slice(0, -1) + input;
            } else if (displayValue.length > 0 && input === '.' && displayValue.slice(-1) === '.') {
                 // Ignore double decimal
            } else {
                displayValue += input;
            }

            currentExpression += input;
            updateCalculatorDisplay();
        }
        
        window.clearDisplay = function() {
            displayValue = '0';
            currentExpression = '';
            resultDisplayed = false;
            updateCalculatorDisplay();
        }

        window.calculateResult = function() {
            try {
                // Sanitize and replace custom math functions for eval
                let safeExpression = displayValue.replace(/sin\(/g, 'Math.sin(')
                                                 .replace(/cos\(/g, 'Math.cos(')
                                                 .replace(/tan\(/g, 'Math.tan(')
                                                 .replace(/log\(/g, 'Math.log10(') // Assuming log base 10
                                                 .replace(/ln\(/g, 'Math.log(')    // Natural log
                                                 .replace(/\^/g, '**')
                                                 .replace(/π/g, 'Math.PI')
                                                 .replace(/√\(/g, 'Math.sqrt(')
                                                 .replace(/e/g, 'Math.E');

                // Basic error handling for incomplete expressions
                if (safeExpression.includes('(') && !safeExpression.includes(')')) {
                    safeExpression += ')';
                }
                
                // Final evaluation
                let result = eval(safeExpression);
                
                // Handle complex numbers, infinity, or NaN
                if (isNaN(result) || !isFinite(result)) {
                    displayValue = 'Error';
                } else {
                    displayValue = result.toString();
                }
                
                currentExpression = safeExpression + ' =';
                resultDisplayed = true;
            } catch (e) {
                displayValue = 'Error';
                currentExpression = 'Invalid Input';
                resultDisplayed = true;
            }
            updateCalculatorDisplay();
        }

        function renderScientificCalculator() {
            const buttonClass = "calc-button text-2xl font-bold p-3 rounded-xl shadow-md transition-all active:shadow-none active:translate-y-0.5";
            const numberClass = `${buttonClass} bg-white text-gray-800 hover:bg-gray-100`;
            const operatorClass = `${buttonClass} bg-orange-500 text-white hover:bg-orange-600`;
            const functionClass = `${buttonClass} bg-blue-100 text-blue-800 hover:bg-blue-200 text-lg`;
            const clearClass = `${buttonClass} bg-red-500 text-white hover:bg-red-600`;

            return `
                <div class="max-w-md mx-auto p-6 bg-gray-200 rounded-3xl shadow-2xl">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        <i data-lucide="calculator" class="w-6 h-6 mr-2 text-blue-600"></i> Scientific Calculator
                    </h2>

                    <div class="mb-4 p-4 bg-gray-800 rounded-xl shadow-inner">
                        <div id="calc-display-history" class="calc-display text-sm text-gray-400 min-h-[1.5rem] overflow-x-auto whitespace-nowrap"></div>
                        <input id="calc-display-result" type="text" value="0" readonly class="calc-display w-full text-4xl font-extrabold text-white bg-transparent border-none focus:ring-0 pt-1 pb-0 mb-0 outline-none overflow-x-auto">
                    </div>

                    <div class="grid grid-cols-5 gap-3">
                        <button onclick="appendInput('sin(')" class="${functionClass}">sin</button>
                        <button onclick="appendInput('cos(')" class="${functionClass}">cos</button>
                        <button onclick="appendInput('tan(')" class="${functionClass}">tan</button>
                        <button onclick="appendInput('log(')" class="${functionClass}">log</button>
                        <button onclick="clearDisplay()" class="${clearClass}">AC</button>
                        
                        <button onclick="appendInput('ln(')" class="${functionClass}">ln</button>
                        <button onclick="appendInput('√(')" class="${functionClass}">√</button>
                        <button onclick="appendInput('π')" class="${functionClass}">π</button>
                        <button onclick="appendInput('^')" class="${functionClass}">^</button>
                        <button onclick="appendInput('/')" class="${operatorClass} text-3xl">÷</button>

                        <button onclick="appendInput('7')" class="${numberClass}">7</button>
                        <button onclick="appendInput('8')" class="${numberClass}">8</button>
                        <button onclick="appendInput('9')" class="${numberClass}">9</button>
                        <button onclick="appendInput('(')" class="${functionClass}">(</button>
                        <button onclick="appendInput('*')" class="${operatorClass}">×</button>

                        <button onclick="appendInput('4')" class="${numberClass}">4</button>
                        <button onclick="appendInput('5')" class="${numberClass}">5</button>
                        <button onclick="appendInput('6')" class="${numberClass}">6</button>
                        <button onclick="appendInput(')')" class="${functionClass}">)</button>
                        <button onclick="appendInput('-')" class="${operatorClass}">−</button>

                        <button onclick="appendInput('1')" class="${numberClass}">1</button>
                        <button onclick="appendInput('2')" class="${numberClass}">2</button>
                        <button onclick="appendInput('3')" class="${numberClass}">3</button>
                        <button onclick="calculateResult()" class="col-span-2 ${operatorClass} bg-green-600 hover:bg-green-700">=</button>
                        
                        <button onclick="appendInput('0')" class="col-span-2 ${numberClass}">0</button>
                        <button onclick="appendInput('.')" class="${numberClass}">.</button>
                        <button onclick="appendInput('+')" class="${operatorClass}">+</button>
                        <button onclick="appendInput('e')" class="${functionClass}">e</button>

                    </div>
                </div>
            `;
        }
        
        // -------------------------------------------------------------------
        // --- 2. PERIODIC TABLE IMPLEMENTATION ---
        // -------------------------------------------------------------------

        const periodicTableData = [
            { symbol: 'H', name: 'Hydrogen', number: 1, mass: 1.008, group: 1, period: 1, type: 'nonmetal' },
            { symbol: 'He', name: 'Helium', number: 2, mass: 4.0026, group: 18, period: 1, type: 'noble-gas' },
            { symbol: 'Li', name: 'Lithium', number: 3, mass: 6.94, group: 1, period: 2, type: 'alkali-metal' },
            { symbol: 'Be', name: 'Beryllium', number: 4, mass: 9.0122, group: 2, period: 2, type: 'alkaline-earth-metal' },
            { symbol: 'B', name: 'Boron', number: 5, mass: 10.81, group: 13, period: 2, type: 'metalloid' },
            { symbol: 'C', name: 'Carbon', number: 6, mass: 12.011, group: 14, period: 2, type: 'nonmetal' },
            { symbol: 'N', name: 'Nitrogen', number: 7, mass: 14.007, group: 15, period: 2, type: 'nonmetal' },
            { symbol: 'O', name: 'Oxygen', number: 8, mass: 15.999, group: 16, period: 2, type: 'nonmetal' },
            { symbol: 'F', name: 'Fluorine', number: 9, mass: 18.998, group: 17, period: 2, type: 'halogen' },
            { symbol: 'Ne', name: 'Neon', number: 10, mass: 20.180, group: 18, period: 2, type: 'noble-gas' },
            { symbol: 'Na', name: 'Sodium', number: 11, mass: 22.990, group: 1, period: 3, type: 'alkali-metal' },
            { symbol: 'Mg', name: 'Magnesium', number: 12, mass: 24.305, group: 2, period: 3, type: 'alkaline-earth-metal' },
            { symbol: 'Al', name: 'Aluminum', number: 13, mass: 26.982, group: 13, period: 3, type: 'post-transition-metal' },
            { symbol: 'Si', name: 'Silicon', number: 14, mass: 28.085, group: 14, period: 3, type: 'metalloid' },
            { symbol: 'P', name: 'Phosphorus', number: 15, mass: 30.974, group: 15, period: 3, type: 'nonmetal' },
            { symbol: 'S', name: 'Sulfur', number: 16, mass: 32.06, group: 16, period: 3, type: 'nonmetal' },
            { symbol: 'Cl', name: 'Chlorine', number: 17, mass: 35.45, group: 17, period: 3, type: 'halogen' },
            { symbol: 'Ar', name: 'Argon', number: 18, mass: 39.948, group: 18, period: 3, type: 'noble-gas' },
            { symbol: 'K', name: 'Potassium', number: 19, mass: 39.098, group: 1, period: 4, type: 'alkali-metal' },
            { symbol: 'Ca', name: 'Calcium', number: 20, mass: 40.078, group: 2, period: 4, type: 'alkaline-earth-metal' },
            { symbol: 'Sc', name: 'Scandium', number: 21, mass: 44.956, group: 3, period: 4, type: 'transition-metal' },
            { symbol: 'Ti', name: 'Titanium', number: 22, mass: 47.867, group: 4, period: 4, type: 'transition-metal' },
            { symbol: 'V', name: 'Vanadium', number: 23, mass: 50.942, group: 5, period: 4, type: 'transition-metal' },
            { symbol: 'Cr', name: 'Chromium', number: 24, mass: 51.996, group: 6, period: 4, type: 'transition-metal' },
            { symbol: 'Mn', name: 'Manganese', number: 25, mass: 54.938, group: 7, period: 4, type: 'transition-metal' },
            { symbol: 'Fe', name: 'Iron', number: 26, mass: 55.845, group: 8, period: 4, type: 'transition-metal' },
            { symbol: 'Co', name: 'Cobalt', number: 27, mass: 58.933, group: 9, period: 4, type: 'transition-metal' },
            { symbol: 'Ni', name: 'Nickel', number: 28, mass: 58.693, group: 10, period: 4, type: 'transition-metal' },
            { symbol: 'Cu', name: 'Copper', number: 29, mass: 63.546, group: 11, period: 4, type: 'transition-metal' },
            { symbol: 'Zn', name: 'Zinc', number: 30, mass: 65.38, group: 12, period: 4, type: 'transition-metal' },
            { symbol: 'Ga', name: 'Gallium', number: 31, mass: 69.723, group: 13, period: 4, type: 'post-transition-metal' },
            { symbol: 'Ge', name: 'Germanium', number: 32, mass: 72.63, group: 14, period: 4, type: 'metalloid' },
            { symbol: 'As', name: 'Arsenic', number: 33, mass: 74.922, group: 15, period: 4, type: 'metalloid' },
            { symbol: 'Se', name: 'Selenium', number: 34, mass: 78.971, group: 16, period: 4, type: 'nonmetal' },
            { symbol: 'Br', name: 'Bromine', number: 35, mass: 79.904, group: 17, period: 4, type: 'halogen' },
            { symbol: 'Kr', name: 'Krypton', number: 36, mass: 83.798, group: 18, period: 4, type: 'noble-gas' },
            { symbol: 'Rb', name: 'Rubidium', number: 37, mass: 85.468, group: 1, period: 5, type: 'alkali-metal' },
            { symbol: 'Sr', name: 'Strontium', number: 38, mass: 87.62, group: 2, period: 5, type: 'alkaline-earth-metal' },
            { symbol: 'Y', name: 'Yttrium', number: 39, mass: 88.906, group: 3, period: 5, type: 'transition-metal' },
            { symbol: 'Zr', name: 'Zirconium', number: 40, mass: 91.224, group: 4, period: 5, type: 'transition-metal' },
            { symbol: 'Nb', name: 'Niobium', number: 41, mass: 92.906, group: 5, period: 5, type: 'transition-metal' },
            { symbol: 'Mo', name: 'Molybdenum', number: 42, mass: 95.96, group: 6, period: 5, type: 'transition-metal' },
            { symbol: 'Tc', name: 'Technetium', number: 43, mass: '(98)', group: 7, period: 5, type: 'transition-metal' },
            { symbol: 'Ru', name: 'Ruthenium', number: 44, mass: 101.07, group: 8, period: 5, type: 'transition-metal' },
            { symbol: 'Rh', name: 'Rhodium', number: 45, mass: 102.91, group: 9, period: 5, type: 'transition-metal' },
            { symbol: 'Pd', name: 'Palladium', number: 46, mass: 106.42, group: 10, period: 5, type: 'transition-metal' },
            { symbol: 'Ag', name: 'Silver', number: 47, mass: 107.87, group: 11, period: 5, type: 'transition-metal' },
            { symbol: 'Cd', name: 'Cadmium', number: 48, mass: 112.41, group: 12, period: 5, type: 'transition-metal' },
            { symbol: 'In', name: 'Indium', number: 49, mass: 114.82, group: 13, period: 5, type: 'post-transition-metal' },
            { symbol: 'Sn', name: 'Tin', number: 50, mass: 118.71, group: 14, period: 5, type: 'post-transition-metal' },
            { symbol: 'Sb', name: 'Antimony', number: 51, mass: 121.76, group: 15, period: 5, type: 'metalloid' },
            { symbol: 'Te', name: 'Tellurium', number: 52, mass: 127.60, group: 16, period: 5, type: 'metalloid' },
            { symbol: 'I', name: 'Iodine', number: 53, mass: 126.90, group: 17, period: 5, type: 'halogen' },
            { symbol: 'Xe', name: 'Xenon', number: 54, mass: 131.29, group: 18, period: 5, type: 'noble-gas' },
            { symbol: 'Cs', name: 'Cesium', number: 55, mass: 132.91, group: 1, period: 6, type: 'alkali-metal' },
            { symbol: 'Ba', name: 'Barium', number: 56, mass: 137.33, group: 2, period: 6, type: 'alkaline-earth-metal' },
            { symbol: 'La', name: 'Lanthanum', number: 57, mass: 138.91, group: 3, period: 6, type: 'lanthanide' }, // 57-71 are Lanthanides
            { symbol: 'Hf', name: 'Hafnium', number: 72, mass: 178.49, group: 4, period: 6, type: 'transition-metal' },
            { symbol: 'Ta', name: 'Tantalum', number: 73, mass: 180.95, group: 5, period: 6, type: 'transition-metal' },
            { symbol: 'W', name: 'Tungsten', number: 74, mass: 183.84, group: 6, period: 6, type: 'transition-metal' },
            { symbol: 'Re', name: 'Rhenium', number: 75, mass: 186.21, group: 7, period: 6, type: 'transition-metal' },
            { symbol: 'Os', name: 'Osmium', number: 76, mass: 190.23, group: 8, period: 6, type: 'transition-metal' },
            { symbol: 'Ir', name: 'Iridium', number: 77, mass: 192.22, group: 9, period: 6, type: 'transition-metal' },
            { symbol: 'Pt', name: 'Platinum', number: 78, mass: 195.08, group: 10, period: 6, type: 'transition-metal' },
            { symbol: 'Au', name: 'Gold', number: 79, mass: 196.97, group: 11, period: 6, type: 'transition-metal' },
            { symbol: 'Hg', name: 'Mercury', number: 80, mass: 200.59, group: 12, period: 6, type: 'transition-metal' },
            { symbol: 'Tl', name: 'Thallium', number: 81, mass: 204.38, group: 13, period: 6, type: 'post-transition-metal' },
            { symbol: 'Pb', name: 'Lead', number: 82, mass: 207.2, group: 14, period: 6, type: 'post-transition-metal' },
            { symbol: 'Bi', name: 'Bismuth', number: 83, mass: 208.98, group: 15, period: 6, type: 'post-transition-metal' },
            { symbol: 'Po', name: 'Polonium', number: 84, mass: '(209)', group: 16, period: 6, type: 'post-transition-metal' },
            { symbol: 'At', name: 'Astatine', number: 85, mass: '(210)', group: 17, period: 6, type: 'halogen' },
            { symbol: 'Rn', name: 'Radon', number: 86, mass: '(222)', group: 18, period: 6, type: 'noble-gas' },
            { symbol: 'Fr', name: 'Francium', number: 87, mass: '(223)', group: 1, period: 7, type: 'alkali-metal' },
            { symbol: 'Ra', name: 'Radium', number: 88, mass: '(226)', group: 2, period: 7, type: 'alkaline-earth-metal' },
            { symbol: 'Ac', name: 'Actinium', number: 89, mass: '(227)', group: 3, period: 7, type: 'actinide' }, // 89-103 are Actinides
            { symbol: 'Rf', name: 'Rutherfordium', number: 104, mass: '(267)', group: 4, period: 7, type: 'transition-metal' },
            { symbol: 'Db', name: 'Dubnium', number: 105, mass: '(268)', group: 5, period: 7, type: 'transition-metal' },
            { symbol: 'Sg', name: 'Seaborgium', number: 106, mass: '(271)', group: 6, period: 7, type: 'transition-metal' },
            { symbol: 'Bh', name: 'Bohrium', number: 107, mass: '(272)', group: 7, period: 7, type: 'transition-metal' },
            { symbol: 'Hs', name: 'Hassium', number: 108, mass: '(270)', group: 8, period: 7, type: 'transition-metal' },
            { symbol: 'Mt', name: 'Meitnerium', number: 109, mass: '(276)', group: 9, period: 7, type: 'unknown' },
            { symbol: 'Ds', name: 'Darmstadtium', number: 110, mass: '(281)', group: 10, period: 7, type: 'unknown' },
            { symbol: 'Rg', name: 'Roentgenium', number: 111, mass: '(280)', group: 11, period: 7, type: 'unknown' },
            { symbol: 'Cn', name: 'Copernicium', number: 112, mass: '(285)', group: 12, period: 7, type: 'unknown' },
            { symbol: 'Nh', name: 'Nihonium', number: 113, mass: '(286)', group: 13, period: 7, type: 'unknown' },
            { symbol: 'Fl', name: 'Flerovium', number: 114, mass: '(289)', group: 14, period: 7, type: 'unknown' },
            { symbol: 'Mc', name: 'Moscovium', number: 115, mass: '(290)', group: 15, period: 7, type: 'unknown' },
            { symbol: 'Lv', name: 'Livermorium', number: 116, mass: '(293)', group: 16, period: 7, type: 'unknown' },
            { symbol: 'Ts', name: 'Tennessine', number: 117, mass: '(294)', group: 17, period: 7, type: 'unknown' },
            { symbol: 'Og', name: 'Oganesson', number: 118, mass: '(294)', group: 18, period: 7, type: 'unknown' },

            // Lanthanides (58-71)
            { symbol: 'Ce', name: 'Cerium', number: 58, mass: 140.12, group: -1, period: 6, type: 'lanthanide' },
            { symbol: 'Pr', name: 'Praseodymium', number: 59, mass: 140.91, group: -1, period: 6, type: 'lanthanide' },
            { symbol: 'Nd', name: 'Neodymium', number: 60, mass: 144.24, group: -1, period: 6, type: 'lanthanide' },
            { symbol: 'Pm', name: 'Promethium', number: 61, mass: '(145)', group: -1, period: 6, type: 'lanthanide' },
            { symbol: 'Sm', name: 'Samarium', number: 62, mass: 150.36, group: -1, period: 6, type: 'lanthanide' },
            { symbol: 'Eu', name: 'Europium', number: 63, mass: 151.96, group: -1, period: 6, type: 'lanthanide' },
            { symbol: 'Gd', name: 'Gadolinium', number: 64, mass: 157.25, group: -1, period: 6, type: 'lanthanide' },
            { symbol: 'Tb', name: 'Terbium', number: 65, mass: 158.93, group: -1, period: 6, type: 'lanthanide' },
            { symbol: 'Dy', name: 'Dysprosium', number: 66, mass: 162.50, group: -1, period: 6, type: 'lanthanide' },
            { symbol: 'Ho', name: 'Holmium', number: 67, mass: 164.93, group: -1, period: 6, type: 'lanthanide' },
            { symbol: 'Er', name: 'Erbium', number: 68, mass: 167.26, group: -1, period: 6, type: 'lanthanide' },
            { symbol: 'Tm', name: 'Thulium', number: 69, mass: 168.93, group: -1, period: 6, type: 'lanthanide' },
            { symbol: 'Yb', name: 'Ytterbium', number: 70, mass: 173.05, group: -1, period: 6, type: 'lanthanide' },
            { symbol: 'Lu', name: 'Lutetium', number: 71, mass: 174.97, group: -1, period: 6, type: 'lanthanide' },

            // Actinides (90-103)
            { symbol: 'Th', name: 'Thorium', number: 90, mass: 232.04, group: -1, period: 7, type: 'actinide' },
            { symbol: 'Pa', name: 'Protactinium', number: 91, mass: 231.04, group: -1, period: 7, type: 'actinide' },
            { symbol: 'U', name: 'Uranium', number: 92, mass: 238.03, group: -1, period: 7, type: 'actinide' },
            { symbol: 'Np', name: 'Neptunium', number: 93, mass: '(237)', group: -1, period: 7, type: 'actinide' },
            { symbol: 'Pu', name: 'Plutonium', number: 94, mass: '(244)', group: -1, period: 7, type: 'actinide' },
            { symbol: 'Am', name: 'Americium', number: 95, mass: '(243)', group: -1, period: 7, type: 'actinide' },
            { symbol: 'Cm', name: 'Curium', number: 96, mass: '(247)', group: -1, period: 7, type: 'actinide' },
            { symbol: 'Bk', name: 'Berkelium', number: 97, mass: '(247)', group: -1, period: 7, type: 'actinide' },
            { symbol: 'Cf', name: 'Californium', number: 98, mass: '(251)', group: -1, period: 7, type: 'actinide' },
            { symbol: 'Es', name: 'Einsteinium', number: 99, mass: '(252)', group: -1, period: 7, type: 'actinide' },
            { symbol: 'Fm', name: 'Fermium', number: 100, mass: '(257)', group: -1, period: 7, type: 'actinide' },
            { symbol: 'Md', name: 'Mendelevium', number: 101, mass: '(258)', group: -1, period: 7, type: 'actinide' },
            { symbol: 'No', name: 'Nobelium', number: 102, mass: '(259)', group: -1, period: 7, type: 'actinide' },
            { symbol: 'Lr', name: 'Lawrencium', number: 103, mass: '(262)', group: -1, period: 7, type: 'actinide' },
        ];

        function getElementByPosition(period, group) {
            let element = periodicTableData.find(e => e.period === period && e.group === group);
            
            // Handle Lanthanide/Actinide block placeholders
            if (period === 6 && group === 3 && !element) {
                // Lanthanides 58-71 fill this spot
                return { symbol: '57-71', name: 'Lanthanides', number: 0, mass: '...', group: 3, period: 6, type: 'lanthanide' };
            }
            if (period === 7 && group === 3 && !element) {
                // Actinides 89-103 fill this spot
                return { symbol: '89-103', name: 'Actinides', number: 0, mass: '...', group: 3, period: 7, type: 'actinide' };
            }

            // Fallback for empty spots that are not Lanthanide/Actinide block.
            if (!element && (period > 1 || group === 18)) {
                return null;
            }
            return element;
        }

        function getElementCardHtml(element) {
            if (!element) {
                return `<div class="p-1 h-14 lg:h-16"></div>`; // Empty cell
            }
            
            const isBlockPlaceholder = ['57-71', '89-103'].includes(element.symbol);
            
            if (isBlockPlaceholder) {
                 return `
                    <div onclick="showLanthanideActinideInfo('${element.symbol.split('-')[0]}')" class="p-1 h-14 lg:h-16 flex flex-col justify-center items-center bg-gray-200 border-2 border-dashed border-gray-400 rounded-lg cursor-pointer hover:bg-gray-300 transition">
                        <span class="text-xs font-semibold text-gray-700">${element.symbol}</span>
                        <span class="text-xs text-gray-600 font-medium">${element.name}</span>
                    </div>
                `;
            }

            const elementClass = `color-${element.type}`;
            const onClickHandler = `showElementProperties(${element.number})`;

            return `
                <div class="element-card ${elementClass} p-1 h-14 lg:h-16 flex flex-col justify-center items-center rounded-lg shadow-md border border-opacity-30 cursor-pointer" onclick="${onClickHandler}">
                    <span class="text-xs font-semibold">${element.number}</span>
                    <span class="text-2xl font-bold mt-[-4px]">${element.symbol}</span>
                    <span class="text-xs font-medium text-center truncate w-full px-1">${element.mass}</span>
                </div>
            `;
        }
        
        window.showLanthanideActinideInfo = function(startNumber) {
            const isLanthanide = startNumber === '57';
            const modal = document.getElementById('element-modal');
            const content = document.getElementById('element-details');
            if (!modal || !content) return;

            const blockName = isLanthanide ? 'Lanthanides (Z=57 to Z=71)' : 'Actinides (Z=89 to Z=103)';
            const dataBlock = periodicTableData.filter(e => e.type === (isLanthanide ? 'lanthanide' : 'actinide') && !['La', 'Ac'].includes(e.symbol))
                                               .map(e => `<span class="inline-block p-1 bg-gray-100 rounded text-xs font-mono mr-2 mb-2">${e.symbol} (${e.number})</span>`)
                                               .join('');


            modal.querySelector('h3').innerHTML = `<i data-lucide="info" class="w-6 h-6 mr-2 text-purple-600"></i> ${blockName}`;
            content.innerHTML = `
                <p class="text-gray-600 mb-4">${blockName} are typically shown separately at the bottom of the table to preserve the vertical alignment of the main block groups.</p>
                <h4 class="font-bold text-gray-700">Elements in this Block:</h4>
                <div class="mt-2 flex flex-wrap max-h-32 overflow-y-auto p-2 border rounded-lg bg-white">
                    ${dataBlock}
                </div>
                <div class="mt-4 text-xs text-gray-500">Click on an element name in the grid below for specific details.</div>
            `;
            
            lucide.createIcons();
            modal.querySelector('#element-modal-content').classList.remove('scale-95', 'opacity-0');
            modal.style.display = 'flex';
        }

        window.showElementProperties = function(atomicNumber) {
            const element = periodicTableData.find(e => e.number === atomicNumber);
            if (!element) return;
            
            const modal = document.getElementById('element-modal');
            const content = document.getElementById('element-details');
            if (!modal || !content) return;
            
            const typeDisplay = element.type.replace(/-/g, ' ').split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');

            modal.querySelector('h3').innerHTML = `<i data-lucide="info" class="w-6 h-6 mr-2 text-blue-600"></i> ${element.name}`;

            content.innerHTML = `
                <div class="grid grid-cols-2 gap-3 text-lg">
                    <div><span class="font-semibold text-gray-600">Symbol:</span> <span class="text-gray-900 font-bold text-2xl">${element.symbol}</span></div>
                    <div><span class="font-semibold text-gray-600">Atomic Number:</span> <span class="text-gray-900 font-bold">${element.number}</span></div>
                    <div><span class="font-semibold text-gray-600">Atomic Mass:</span> <span class="text-gray-900 font-bold">${element.mass}</span></div>
                    <div><span class="font-semibold text-gray-600">Group:</span> <span class="text-gray-900 font-bold">${element.group > 0 ? element.group : 'Inner Transition'}</span></div>
                    <div><span class="font-semibold text-gray-600">Period:</span> <span class="text-gray-900 font-bold">${element.period}</span></div>
                    <div><span class="font-semibold text-gray-600">Type:</span> <span class="font-bold text-sm color-${element.type} px-2 py-0.5 rounded-full inline-block">${typeDisplay}</span></div>
                </div>
            `;
            
            lucide.createIcons();
            modal.querySelector('#element-modal-content').classList.remove('scale-95', 'opacity-0');
            modal.style.display = 'flex';
        }

        window.closeElementProperties = function() {
            const modal = document.getElementById('element-modal');
            if(!modal) return;
            modal.querySelector('#element-modal-content').classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function renderPeriodicTable() {
            let tableHtml = '<div class="periodic-table-grid overflow-x-auto p-2"><div class="inline-grid gap-1 lg:gap-2" style="grid-template-columns: repeat(18, minmax(0, 1fr));">';

            // 1. Group Headers
            tableHtml += '<div class="p-1 h-8 lg:h-10"></div>'; // Empty top-left cell
            for (let g = 1; g <= 18; g++) {
                tableHtml += `<div class="text-center font-bold text-sm text-gray-600 p-1 h-8 lg:h-10">${g}</div>`;
            }
            
            // 2. Main Block (Periods 1-7)
            for (let p = 1; p <= 7; p++) {
                // Period Header
                tableHtml += `<div class="text-center font-bold text-sm text-gray-600 p-1 h-14 lg:h-16">${p}</div>`; 
                for (let g = 1; g <= 18; g++) {
                    const element = getElementByPosition(p, g);
                    
                    // Special layout for Period 1 (H and He)
                    if (p === 1) {
                        if (g === 1) {
                            tableHtml += getElementCardHtml(element); // H
                        } else if (g >= 2 && g <= 17) {
                            tableHtml += getElementCardHtml(null); // Empty spaces
                        } else if (g === 18) {
                            tableHtml += getElementCardHtml(element); // He
                        }
                    } 
                    // Special layout for Periods 2 & 3 (1-2 and 13-18)
                    else if (p >= 2 && p <= 3) {
                         if ((g >= 3 && g <= 12)) {
                            tableHtml += getElementCardHtml(null); // Empty spaces
                         } else {
                            tableHtml += getElementCardHtml(element);
                         }
                    } 
                    // Special layout for Periods 6 & 7 (Lanthanide/Actinide block placeholders)
                    else if (p === 6 || p === 7) {
                        if (g === 3 && element && ['57-71', '89-103'].includes(element.symbol)) {
                            tableHtml += getElementCardHtml(element); // Block Placeholder
                        } else if (g >= 13 && g <= 18 && element && (element.period < p)) {
                             tableHtml += getElementCardHtml(null); // Fix for Hf/Rf position having a gap
                        } else {
                            tableHtml += getElementCardHtml(element);
                        }
                    }
                    // Regular layout for Periods 4 & 5
                    else if (p >= 4 && p <= 5) {
                        tableHtml += getElementCardHtml(element);
                    }
                    
                }
            }
            
            tableHtml += '</div></div>'; // Close main block grid

            // 3. Inner Transition Metals (Lanthanides and Actinides)
            const innerTransitionHtml = `
                <div class="mt-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2 flex items-center">
                         <i data-lucide="sparkles" class="w-5 h-5 mr-2 text-blue-500"></i> Inner Transition Metals
                    </h3>
                    <div class="periodic-table-grid overflow-x-auto p-2">
                        <div class="inline-grid gap-1 lg:gap-2" style="grid-template-columns: repeat(15, minmax(0, 1fr));">
                            <div class="text-center font-bold text-sm text-gray-600 p-1 h-8 lg:h-10 col-span-1"></div>

                            <div class="text-center font-bold text-sm text-gray-600 p-1 h-14 lg:h-16">6</div> 
                            ${periodicTableData.filter(e => e.type === 'lanthanide' && !['La', '57-71'].includes(e.symbol)).map(e => getElementCardHtml(e)).join('')}
                            
                            <div class="text-center font-bold text-sm text-gray-600 p-1 h-14 lg:h-16">7</div> 
                            ${periodicTableData.filter(e => e.type === 'actinide' && !['Ac', '89-103'].includes(e.symbol)).map(e => getElementCardHtml(e)).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            // 4. Color Key
            const colorKeyHtml = `
                <div class="mt-8 p-4 bg-white rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-gray-800 mb-3 border-b pb-2 flex items-center">
                        <i data-lucide="palette" class="w-5 h-5 mr-2 text-indigo-500"></i> Element Type Key
                    </h3>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 text-sm font-medium">
                        <span class="color-nonmetal p-1 rounded-md text-center">Nonmetal</span>
                        <span class="color-noble-gas p-1 rounded-md text-center">Noble Gas</span>
                        <span class="color-halogen p-1 rounded-md text-center">Halogen</span>
                        <span class="color-metalloid p-1 rounded-md text-center">Metalloid</span>
                        <span class="color-alkali-metal p-1 rounded-md text-center">Alkali Metal</span>
                        <span class="color-alkaline-earth-metal p-1 rounded-md text-center">Alkaline Earth Metal</span>
                        <span class="color-transition-metal p-1 rounded-md text-center">Transition Metal</span>
                        <span class="color-post-transition-metal p-1 rounded-md text-center">Post-Transition Metal</span>
                        <span class="color-lanthanide p-1 rounded-md text-center">Lanthanide</span>
                        <span class="color-actinide p-1 rounded-md text-center">Actinide</span>
                        <span class="color-unknown p-1 rounded-md text-center">Unknown</span>
                    </div>
                </div>
            `;


            return `
                <div class="p-4">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i data-lucide="atom" class="w-6 h-6 mr-2 text-blue-600"></i> Modern Periodic Table
                    </h2>
                    ${tableHtml}
                    ${innerTransitionHtml}
                    ${colorKeyHtml}
                </div>
            `;
        }
        
        // -------------------------------------------------------------------
        // --- 3. UNIT CONVERTER IMPLEMENTATION ---
        // -------------------------------------------------------------------
        
        const units = {
            'Length': {
                'Meter (m)': 1,
                'Kilometer (km)': 1000,
                'Centimeter (cm)': 0.01,
                'Millimeter (mm)': 0.001,
                'Micrometer (µm)': 1e-6,
                'Nanometer (nm)': 1e-9,
                'Mile (mi)': 1609.34,
                'Yard (yd)': 0.9144,
                'Foot (ft)': 0.3048,
                'Inch (in)': 0.0254,
                'Angstrom (Å)': 1e-10,
            },
            'Mass': {
                'Kilogram (kg)': 1,
                'Gram (g)': 0.001,
                'Milligram (mg)': 1e-6,
                'Metric Ton (t)': 1000,
                'Pound (lb)': 0.453592,
                'Ounce (oz)': 0.0283495,
                'Atomic Mass Unit (amu/Da)': 1.66053906660e-27,
            },
            'Volume': {
                'Cubic Meter (m³)': 1,
                'Liter (L)': 0.001,
                'Milliliter (mL)': 1e-6,
                'US Gallon (gal)': 0.00378541,
                'Cubic Foot (ft³)': 0.0283168,
            },
            'Temperature': { // Special handling needed
                'Celsius (°C)': 'C',
                'Fahrenheit (°F)': 'F',
                'Kelvin (K)': 'K',
            },
            'Time': {
                'Second (s)': 1,
                'Minute (min)': 60,
                'Hour (hr)': 3600,
                'Day (day)': 86400,
                'Year (year)': 31536000,
            },
            'Energy': {
                'Joule (J)': 1,
                'Kilojoule (kJ)': 1000,
                'Calorie (cal)': 4.184,
                'Kilocalorie (kcal)': 4184,
                'Electronvolt (eV)': 1.602176634e-19,
            }
        };

        function initializeUnitConverter() {
            populateCategoryDropdown();
            // Set initial category and units
            const categoryDropdown = document.getElementById('unit-category');
            if(categoryDropdown) categoryDropdown.value = 'Length';
            populateUnitDropdowns('Length');
            convertUnit(); // Run initial conversion
        }

        function populateCategoryDropdown() {
            const dropdown = document.getElementById('unit-category');
            if (!dropdown) return;
            dropdown.innerHTML = Object.keys(units).map(cat => 
                `<option value="${cat}">${cat}</option>`
            ).join('');
        }

        window.populateUnitDropdowns = function(category) {
            const fromDropdown = document.getElementById('unit-from');
            const toDropdown = document.getElementById('unit-to');
            const categoryUnits = units[category];
            
            if (!fromDropdown || !toDropdown || !categoryUnits) return;
            
            const optionsHtml = Object.keys(categoryUnits).map(unit => 
                `<option value="${unit}">${unit}</option>`
            ).join('');
            
            fromDropdown.innerHTML = optionsHtml;
            toDropdown.innerHTML = optionsHtml;
            
            // Auto-select different units if possible
            const unitNames = Object.keys(categoryUnits);
            if (unitNames.length > 1) {
                fromDropdown.value = unitNames[0];
                toDropdown.value = unitNames[1];
            } else if (unitNames.length === 1) {
                 fromDropdown.value = unitNames[0];
                 toDropdown.value = unitNames[0];
            }
            
            convertUnit();
        }

        window.convertUnit = function() {
            const categoryEl = document.getElementById('unit-category');
            const fromUnitEl = document.getElementById('unit-from');
            const toUnitEl = document.getElementById('unit-to');
            const inputEl = document.getElementById('input-value');
            const resultDisplay = document.getElementById('result-value');

            if (!categoryEl || !fromUnitEl || !toUnitEl || !inputEl || !resultDisplay) return;
            
            const category = categoryEl.value;
            const fromUnit = fromUnitEl.value;
            const toUnit = toUnitEl.value;
            const inputValue = parseFloat(inputEl.value);
            
            if (isNaN(inputValue)) {
                resultDisplay.value = 'Invalid Input';
                return;
            }
            
            if (category === 'Temperature') {
                const result = convertTemperature(inputValue, fromUnit, toUnit);
                resultDisplay.value = isNaN(result) ? 'Error' : result.toFixed(2);
                return;
            }
            
            const conversionFactors = units[category];
            if (!conversionFactors || !conversionFactors[fromUnit] || !conversionFactors[toUnit]) {
                 resultDisplay.value = 'Conversion Error';
                 return;
            }

            // Convert 'From' to the base unit, then convert base unit to 'To' unit
            const valueInBase = inputValue * conversionFactors[fromUnit];
            const result = valueInBase / conversionFactors[toUnit];

            resultDisplay.value = result.toPrecision(6); 
        }
        
        function convertTemperature(value, fromUnit, toUnit) {
            let tempInKelvin;

            // 1. Convert to Kelvin (Base Unit)
            if (fromUnit === 'Celsius (°C)') {
                tempInKelvin = value + 273.15;
            } else if (fromUnit === 'Fahrenheit (°F)') {
                tempInKelvin = (value - 32) * 5/9 + 273.15;
            } else if (fromUnit === 'Kelvin (K)') {
                tempInKelvin = value;
            } else {
                return NaN;
            }

            // 2. Convert from Kelvin to the 'To' Unit
            if (toUnit === 'Celsius (°C)') {
                return tempInKelvin - 273.15;
            } else if (toUnit === 'Fahrenheit (°F)') {
                return (tempInKelvin - 273.15) * 9/5 + 32;
            } else if (toUnit === 'Kelvin (K)') {
                return tempInKelvin;
            } else {
                return NaN;
            }
        }


        function renderUnitConverter() {
             return `
                <div class="max-w-2xl mx-auto p-6 bg-white rounded-3xl shadow-lg border border-gray-100">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i data-lucide="scale" class="w-6 h-6 mr-2 text-blue-600"></i> Scientific Unit Converter
                    </h2>

                    <div class="mb-6">
                        <label for="unit-category" class="block text-sm font-medium text-gray-700 mb-2">Conversion Category</label>
                        <select id="unit-category" onchange="populateUnitDropdowns(this.value)" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm bg-gray-50">
                            </select>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-center">
                        
                        <div class="md:col-span-2">
                            <label for="input-value" class="block text-sm font-medium text-gray-700 mb-2">Input Value</label>
                            <input type="number" id="input-value" value="1" oninput="convertUnit()" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-3 font-mono text-lg border-2">
                        </div>

                        <div class="md:col-span-1">
                            <label for="unit-from" class="block text-sm font-medium text-gray-700 mb-2">From</label>
                            <select id="unit-from" onchange="convertUnit()" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm">
                                </select>
                        </div>
                        
                        <div class="flex justify-center text-blue-500">
                             <i data-lucide="chevrons-right-left" class="w-6 h-6"></i>
                        </div>

                        <div class="md:col-span-1">
                            <label for="unit-to" class="block text-sm font-medium text-gray-700 mb-2">To</label>
                            <select id="unit-to" onchange="convertUnit()" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm">
                                </select>
                        </div>

                    </div>
                    
                    <div class="mt-8 pt-4 border-t">
                         <label for="result-value" class="block text-sm font-medium text-gray-700 mb-2">Converted Result</label>
                         <input type="text" id="result-value" value="0.00" readonly class="block w-full rounded-md border-gray-300 shadow-lg bg-blue-50 text-blue-800 font-mono text-2xl p-4 border-2 border-blue-200">
                    </div>
                    
                    <div class="mt-4 text-xs text-gray-500">Note: Temperature conversions are handled using specific formulas, not simple ratios. Precision is limited for complex conversions.</div>
                </div>
            `;
        }

        // --- OTHER PAGE RENDERING LOGIC (omitted for brevity, but remains in the file) ---

        function renderErrorPage(title, message) {
            return `
                <div class="content-area p-10 text-center">
                    <i data-lucide="alert-triangle" class="w-12 h-12 text-red-500 mx-auto"></i>
                    <h1 class="text-3xl font-extrabold text-gray-900 mt-4">${title}</h1>
                    <p class="text-gray-600 mt-2">${message}</p>
                    <button onclick="renderPage('dashboard')" class="mt-6 hikmah-bg-primary text-white px-6 py-3 rounded-lg font-semibold shadow-md hover:hikmah-hover transition">
                        Go to Dashboard
                    </button>
                </div>
            `;
        }
        
        function renderDashboardPage() {
             const completed = calculateCompletedChapters();
             const total = calculateTotalChapters();
             const completionPercentage = total > 0 ? Math.round((completed / total) * 100) : 0;
             
             return `
                <div class="content-area p-6 lg:p-10">
                    
                    <div class="bg-gradient-to-r from-green-50 to-blue-50 p-8 rounded-3xl shadow-2xl mb-10 welcome-card-animate opacity-0" style="animation-delay: 0.1s;">
                        <h1 class="text-3xl lg:text-5xl font-extrabold text-gray-900 mb-2 welcome-text-animate" style="animation-delay: 0.5s;">
                             <i data-lucide="sparkles" class="w-8 h-8 mr-2 inline-block text-yellow-500 animate-pulse"></i>
                             Welcome to Neab Learning!
                        </h1>
                        <p class="text-lg text-gray-700 mb-6 welcome-text-animate" style="animation-delay: 0.7s;">
                             Your Class 12 PCMB platform for academic year 2025-2026. Let's start learning!
                        </p>

                        <div class="border-t pt-4 border-blue-200 welcome-text-animate" style="animation-delay: 0.9s;">
                            <div class="flex justify-between items-center mb-2">
                                <h2 class="text-xl font-bold text-blue-800 flex items-center">
                                    <i data-lucide="target" class="w-5 h-5 mr-2"></i> Study Goal Progress
                                </h2>
                                <span class="text-3xl font-extrabold text-blue-600">${completionPercentage}%</span>
                            </div>
                            <div class="w-full bg-blue-200 rounded-full h-3">
                                <div class="hikmah-bg-primary h-3 rounded-full transition-all duration-1000" style="width: ${completionPercentage}%"></div>
                            </div>
                            <p class="text-sm text-blue-700 mt-3">Total Chapters Completed: <b>${completed}</b> out of <b>${total}</b></p>
                        </div>
                    </div>


                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        ${renderSubjectCard('Physics', 'text-blue-500', 'bg-blue-500')}
                        ${renderSubjectCard('Chemistry', 'text-orange-500', 'bg-orange-500')}
                        ${renderSubjectCard('Math', 'text-green-500', 'bg-green-500')}
                        ${renderSubjectCard('Biology', 'text-purple-500', 'bg-purple-500')}
                    </div>

                    <div class="mt-12">
                        <h2 class="text-2xl font-extrabold text-gray-900 mb-6 border-b pb-3 flex items-center">
                             <i data-lucide="zap" class="w-6 h-6 mr-2 text-yellow-500"></i> Featured Advanced Courses
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            ${courseData.map(course => renderCourseCard(course)).join('')}
                        </div>
                    </div>
                </div>
             `;
        }

        function renderSubjectCard(subject, textColorClass, bgColorClass) {
            const totalChapters = ncertChapters[subject].length;
            const completedChapters = ncertChapters[subject].filter(chapter => userProgress[chapter.id]?.completed).length;
            const percentage = totalChapters > 0 ? Math.round((completedChapters / totalChapters) * 100) : 0;
            const iconMap = { 'Physics': 'cpu', 'Chemistry': 'flask-conical', 'Math': 'sigma', 'Biology': 'dna' };

            return `
                <div onclick="renderPage('subject', '${subject}')" class="bg-white p-6 rounded-xl shadow-lg hover:shadow-2xl transition duration-300 transform hover:scale-[1.02] cursor-pointer border-t-4 ${bgColorClass.replace('bg-', 'border-')}">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold ${textColorClass}">${subject}</h2>
                        <i data-lucide="${iconMap[subject]}" class="w-8 h-8 ${textColorClass} opacity-70"></i>
                    </div>
                    <p class="text-sm text-gray-500 mb-4">${completedChapters} / ${totalChapters} Chapters Completed</p>
                    
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="${bgColorClass} h-2.5 rounded-full" style="width: ${percentage}%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2 font-medium">${percentage}% Completion</p>
                </div>
            `;
        }
        
        function renderSubjectPage(subject) {
            const chapters = ncertChapters[subject];
            const iconMap = { 'Physics': 'cpu', 'Chemistry': 'flask-conical', 'Math': 'sigma', 'Biology': 'dna' };
            const colorMap = { 'Physics': 'blue', 'Chemistry': 'orange', 'Math': 'green', 'Biology': 'purple' };
            const iconName = iconMap[subject] || 'book-open';
            const color = colorMap[subject] || 'gray';

            const chapterListHtml = chapters.map(chapter => {
                const isCompleted = userProgress[chapter.id]?.completed || false;
                const statusIcon = isCompleted ? `<i data-lucide="check-circle" class="w-5 h-5 text-green-500 mr-2"></i>` : `<i data-lucide="circle" class="w-5 h-5 text-gray-400 mr-2"></i>`;
                const cardClass = isCompleted ? `bg-${color}-50 border-${color}-400 shadow-md` : 'bg-white border-gray-200 shadow-sm';
                const textClass = isCompleted ? 'text-gray-800' : 'text-gray-700';
                
                return `
                    <div onclick="renderPage('lesson', '${subject}', '${chapter.id}')" 
                        class="chapter-card p-5 border-l-4 ${cardClass} rounded-xl hover:border-l-8 hover:border-${color}-500 transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="text-lg font-bold w-10 text-center text-${color}-500 mr-4">${chapter.chapter}.</span>
                                <h3 class="text-lg font-semibold ${textClass}">${chapter.title}</h3>
                            </div>
                            ${statusIcon}
                        </div>
                    </div>
                `;
            }).join('');
            
            return `
                <div class="content-area p-6 lg:p-10">
                    <h1 class="text-3xl lg:text-4xl font-extrabold text-gray-900 mb-8 border-b pb-4 flex items-center">
                        <i data-lucide="${iconName}" class="w-8 h-8 mr-3 text-${color}-600"></i> ${subject} - Class 12 NCERT Syllabus
                    </h1>
                    
                    <div class="space-y-4">
                        ${chapterListHtml}
                    </div>
                </div>
            `;
        }

        function renderLessonPage(subject, chapterId) {
            const chapter = ncertChapters[subject].find(c => c.id === chapterId);
            if (!chapter) return renderErrorPage('Chapter Not Found', 'The chapter reference is invalid.');

            const colorMap = { 'Physics': 'blue', 'Chemistry': 'orange', 'Math': 'green', 'Biology': 'purple' };
            const color = colorMap[subject] || 'gray';
            const isCompleted = userProgress[chapterId]?.completed || false;
            
            const completionToggle = `
                 <button onclick="toggleChapterComplete('${subject}', '${chapterId}', ${!isCompleted})" 
                     class="flex items-center text-sm font-semibold transition ${isCompleted ? 'bg-green-500 hover:bg-green-600 text-white' : 'bg-gray-200 hover:bg-gray-300 text-gray-800'} px-4 py-2 rounded-lg shadow-md">
                     <i data-lucide="${isCompleted ? 'check-circle' : 'circle'}" class="w-5 h-5 mr-2"></i>
                     ${isCompleted ? 'Mark as Incomplete' : 'Mark as Complete'}
                 </button>
            `;

            return `
                <div class="content-area p-6 lg:p-10">
                    <div class="mb-8 border-b pb-4">
                        <p class="text-lg font-medium text-${color}-600 mb-1">${subject} - Chapter ${chapter.chapter}</p>
                        <h1 class="text-3xl lg:text-4xl font-extrabold text-gray-900">${chapter.title}</h1>
                        <div class="mt-4 flex justify-end">
                            ${completionToggle}
                        </div>
                    </div>

                    <div id="filter-tabs" class="flex space-x-4 border-b-2 mb-6">
                        <button id="tab-Notes" onclick="updateLessonContent('Notes', '${subject}', '${chapterId}')" class="tab-button tab-active">Notes</button>
                        <button id="tab-Key Formulas" onclick="updateLessonContent('Key Formulas', '${subject}', '${chapterId}')" class="tab-button tab-inactive">Key Formulas</button>
                        <button id="tab-Practice" onclick="updateLessonContent('Practice', '${subject}', '${chapterId}')" class="tab-button tab-inactive">Practice Problems</button>
                        <button id="tab-Video" onclick="updateLessonContent('Video', '${subject}', '${chapterId}')" class="tab-button tab-inactive">Video Resources</button>
                    </div>

                    <div id="lesson-content-display" class="min-h-[50vh] fade-in-content">
                        <div class="text-center py-20">
                            <i data-lucide="loader" class="w-8 h-8 animate-spin text-gray-400 mx-auto"></i>
                            <p class="text-gray-600 mt-3">Loading content...</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        window.updateLessonContent = function(tabName, subject, chapterId) {
            const contentDiv = document.getElementById('lesson-content-display');
            if (!contentDiv) return;
            
            // 1. Update Tab Styles
            const tabs = ['Notes', 'Key Formulas', 'Practice', 'Video'];
            tabs.forEach(tab => {
                const btn = document.getElementById(`tab-${tab}`);
                if (btn) {
                    btn.className = (tab === tabName) 
                        ? 'tab-button tab-active'
                        : 'tab-button tab-inactive';
                }
            });
            
            // Apply fade-in animation
            contentDiv.classList.remove('fade-in-content');
            void contentDiv.offsetWidth; 
            contentDiv.classList.add('fade-in-content');

            // 2. Generate Content
            let contentHtml = '';
            
            if (tabName === 'Notes') {
                contentHtml = generateNotesContent(subject, chapterId);
            } else if (tabName === 'Key Formulas') {
                contentHtml = generateFormulaContent(chapterId);
            } else if (tabName === 'Practice') {
                contentHtml = generatePlaceholderContent('Practice Problems', 'Solve questions related to this chapter. Coming Soon!');
            } else if (tabName === 'Video') {
                contentHtml = generatePlaceholderContent('Video Resources', 'Watch curated video lectures and solved problems. Coming Soon!');
            }
            
            // 3. Inject and Re-render Icons/Math
            contentDiv.innerHTML = contentHtml;
            lucide.createIcons();
            
            if (tabName === 'Key Formulas') {
                 // Trigger MathJax rendering if available
                 if (window.MathJax) {
                     MathJax.typesetPromise([contentDiv]).catch((err) => console.error('MathJax Error:', err));
                 }
            }
        }
        
        function generateNotesContent(subject, chapterId) {
            const chapter = ncertChapters[subject].find(c => c.id === chapterId);
            const chapterTitle = chapter ? chapter.title : 'Chapter';
            
            return `
                <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-inner">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Overview: ${chapterTitle}</h2>
                    <p class="text-gray-700 leading-relaxed mb-6">
                        This section contains detailed, concise notes covering the essential concepts, definitions, and theories from the NCERT syllabus for ${subject}. 
                        Master the core principles before moving on to formulas and practice.
                    </p>
                    
                    <div class="space-y-6">
                        ${renderNoteSection('Concept 1: Introduction', 'This is where the detailed explanatory content for the first concept of the chapter would be placed. This includes definitions, diagrams, and underlying principles. Currently showing placeholder content.')}
                        ${renderNoteSection('Concept 2: Key Definitions', 'Explore the important terms and terminologies used throughout the chapter, ensuring you have a solid vocabulary foundation for further study. Currently showing placeholder content.')}
                        ${renderNoteSection('Concept 3: Applications & Examples', 'See how the theories are applied in real-world scenarios and solved examples. Currently showing placeholder content.')}
                    </div>

                    <div class="mt-8 p-4 bg-yellow-50 text-yellow-800 rounded-lg flex items-start">
                        <i data-lucide="lightbulb" class="w-5 h-5 mr-3 mt-1 flex-shrink-0"></i>
                        <p class="text-sm">
                            <b>Tip:</b> After reviewing the notes, test your understanding by attempting the practice problems.
                        </p>
                    </div>
                </div>
            `;
        }

        function renderNoteSection(title, content) {
            return `
                <div class="border-l-4 border-green-500 pl-4">
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">${title}</h3>
                    <p class="text-gray-600">${content}</p>
                </div>
            `;
        }
        
        function generateFormulaContent(chapterId) {
            const formulas = chapterFormulas[chapterId] || [];

            if (formulas.length === 0) {
                return generatePlaceholderContent('Key Formulas', 'No key formulas have been added for this chapter yet. Please check back later!');
            }

            const formulaListHtml = formulas.map(item => `
                <div class="bg-gray-50 p-5 rounded-xl border border-gray-200 shadow-sm">
                    <h3 class="text-xl font-bold text-gray-800 mb-3 flex items-center">
                        <i data-lucide="square-root" class="w-5 h-5 mr-2 text-red-500"></i> ${item.name}
                    </h3>
                    <div class="p-3 bg-white rounded-lg border border-red-200 overflow-x-auto text-center">
                        ${item.formula}
                    </div>
                </div>
            `).join('');

            return `
                 <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-inner">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Essential Formulas</h2>
                    <p class="text-gray-700 leading-relaxed mb-6">
                        Quick reference for all the crucial mathematical formulas required for calculations and derivations in this chapter.
                    </p>
                    
                    <div class="space-y-6">
                        ${formulaListHtml}
                    </div>
                </div>
            `;
        }

        function generatePlaceholderContent(title, message) {
            return `
                <div class="text-center py-20 bg-white rounded-xl border border-gray-100 shadow-inner">
                    <i data-lucide="tool" class="w-12 h-12 text-indigo-500 mx-auto"></i>
                    <h2 class="text-2xl font-extrabold text-gray-900 mt-4">${title}</h2>
                    <p class="text-gray-600 mt-2 max-w-md mx-auto">${message}</p>
                    <div class="mt-6">
                        <i data-lucide="calendar" class="w-5 h-5 inline-block text-gray-400 mr-2"></i>
                        <span class="text-sm text-gray-500">Content Release: Q4 2025</span>
                    </div>
                </div>
            `;
        }
        
        function renderProfilePage() {
            const completed = calculateCompletedChapters();
            const total = calculateTotalChapters();
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
            const userDisplayId = userId.length > 15 ? userId.substring(0, 12) + '...' : userId;

            // Calculate progress per subject
            const subjectProgress = {};
            for (const subject in ncertChapters) {
                const totalC = ncertChapters[subject].length;
                const completedC = ncertChapters[subject].filter(chapter => userProgress[chapter.id]?.completed).length;
                subjectProgress[subject] = { total: totalC, completed: completedC, percentage: totalC > 0 ? Math.round((completedC / totalC) * 100) : 0 };
            }

            const subjectProgressHtml = Object.keys(subjectProgress).map(subject => {
                 const p = subjectProgress[subject];
                 const colorMap = { 'Physics': 'blue', 'Chemistry': 'orange', 'Math': 'green', 'Biology': 'purple' };
                 const color = colorMap[subject] || 'gray';
                 const colorClass = `bg-${color}-500`;

                 return `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-medium text-gray-700">${subject}</span>
                            <span class="text-sm font-semibold">${p.completed} / ${p.total} (${p.percentage}%)</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="${colorClass} h-2 rounded-full" style="width: ${p.percentage}%"></div>
                        </div>
                    </div>
                 `;
            }).join('');
            
            return `
                <div class="content-area p-6 lg:p-10">
                    <h1 class="text-3xl lg:text-4xl font-extrabold text-gray-900 mb-8 border-b pb-4 flex items-center">
                        <i data-lucide="user-circle" class="w-8 h-8 mr-3 text-red-500"></i> My Profile & Analytics
                    </h1>

                    <div class="bg-gray-50 p-6 rounded-xl shadow-inner mb-8">
                        <div class="flex items-center space-x-4">
                             <div class="hikmah-bg-primary text-white w-12 h-12 flex items-center justify-center rounded-full font-bold text-xl">
                                 U
                             </div>
                             <div>
                                <h2 class="text-xl font-bold text-gray-800">Class 12 Student (Default Account)</h2>
                                <p class="text-sm text-gray-500">User ID: ${userDisplayId}</p>
                             </div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-6 rounded-2xl shadow-xl mb-10 border-l-4 border-blue-500">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-blue-800 flex items-center">
                                <i data-lucide="trending-up" class="w-5 h-5 mr-2"></i> Overall Course Completion
                            </h2>
                            <span class="text-2xl font-extrabold text-blue-600">${percentage}%</span>
                        </div>
                        <div class="w-full bg-blue-200 rounded-full h-2.5">
                            <div class="hikmah-bg-primary h-2.5 rounded-full" style="width: ${percentage}%"></div>
                        </div>
                        <p class="text-sm text-blue-700 mt-3">Total Chapters Completed: <b>${completed}</b> out of <b>${total}</b></p>
                    </div>

                    <div class="mt-8">
                        <h2 class="text-2xl font-extrabold text-gray-900 mb-6 border-b pb-3 flex items-center">
                             <i data-lucide="bar-chart-3" class="w-6 h-6 mr-2 text-indigo-500"></i> Subject Breakdown
                        </h2>
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            ${subjectProgressHtml}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderNotificationPage() {
            const notifications = generateRealTimeNotifications();
            
            if (notifications.length === 0) {
                 return generatePlaceholderContent('Notifications', 'No new notifications.');
            }
            
            const notificationListHtml = notifications.map(n => {
                const date = new Date(n.date).toLocaleString('en-US', { dateStyle: 'medium', timeStyle: 'short' });
                const iconMap = { 'System': 'server', 'Progress': 'zap' };
                const colorMap = { 'System': 'blue', 'Progress': 'green' };
                const icon = iconMap[n.type] || 'message-square';
                const color = colorMap[n.type] || 'gray';
                
                const readClass = n.read ? 'bg-white hover:bg-gray-100 text-gray-600' : 'bg-white shadow-md border-l-4 border-yellow-500 hover:bg-yellow-50 text-gray-800';
                
                return `
                    <div onclick="${n.action};" class="p-4 rounded-xl transition duration-200 cursor-pointer ${readClass}">
                        <div class="flex items-start justify-between">
                            <div class="flex items-start">
                                <i data-lucide="${icon}" class="w-5 h-5 mr-3 mt-1 text-${color}-600 flex-shrink-0"></i>
                                <div>
                                    <h3 class="font-bold text-lg">${n.title}</h3>
                                    <p class="text-sm mt-1">${n.message.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')}</p>
                                </div>
                            </div>
                            <span class="text-xs text-gray-400 mt-1 flex-shrink-0">${date}</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            return `
                <div class="content-area p-6 lg:p-10">
                    <h1 class="text-3xl lg:text-4xl font-extrabold text-gray-900 mb-8 border-b pb-4 flex items-center">
                        <i data-lucide="bell" class="w-8 h-8 mr-3 text-yellow-500"></i> Notifications
                    </h1>

                    <div class="space-y-4">
                        ${notificationListHtml}
                    </div>
                </div>
            `;
        }

        function renderCourseCard(course) {
            const bgColorClass = course.subject === 'Physics' ? 'bg-blue-500' : 
                                 course.subject === 'Chemistry' ? 'bg-orange-500' : 
                                 course.subject === 'Math' ? 'bg-green-500' : 
                                 'bg-purple-500';
            const hoverClass = bgColorClass.replace('-500', '-600');
            const accessClass = 'bg-gray-400';

            return `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100">
                    <img class="w-full h-40 object-cover" src="${course.image}" alt="${course.title}">
                    <div class="p-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">${course.title}</h3>
                        <p class="text-gray-600 text-sm mb-4">${course.description}</p>
                        
                        <div class="grid grid-cols-3 gap-4 text-xs text-gray-500 mb-6 border-t border-b py-3">
                            <div class="text-center">
                                <i data-lucide="tag" class="w-4 h-4 mx-auto mb-1 text-${course.subject === 'Physics' ? 'blue' : course.subject === 'Chemistry' ? 'orange' : course.subject === 'Math' ? 'green' : 'purple'}-500"></i>
                                <span class="block font-semibold text-gray-800">${course.subject}</span>
                                <span class="block">Subject</span>
                            </div>
                            <div class="text-center">
                                <i data-lucide="clock" class="w-4 h-4 mx-auto mb-1 text-gray-400"></i>
                                <span class="block font-semibold text-gray-800">TBD</span>
                                <span class="block">Lectures</span>
                            </div>
                            <div class="text-center">
                                <i data-lucide="users" class="w-4 h-4 mx-auto mb-1 text-green-500"></i>
                                <span class="block font-semibold text-gray-800">Enroll Early</span>
                                <span class="block">Status</span>
                            </div>
                        </div>

                        <button class="w-full flex items-center justify-center ${accessClass} text-white py-2.5 rounded-lg font-semibold shadow-xl ${hoverClass} transition pointer-events-none">
                            <i data-lucide="calendar-search" class="w-5 h-5 mr-2"></i>
                            Content Release Soon
                        </button>
                    </div>
                </div>
            `;
        }


        window.onload = function() {
            // FIX: Call the local app logic directly to ensure the dashboard renders.
            initializeAppLogic();
        };
    </script>
</body>
</html>